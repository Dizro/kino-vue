import{_ as j,c,o as r,a as i,b as h,d as y,e as x,f as P,w as b,n as $,g as k,h as w,t as C,u as G,r as V,i as Y,j as Q,k as O,l as S,m as R,v as L,F as q,p as M,q as p,s as H,x as B,y as J,M as K}from"./index-DyXVGfsC.js";import{_ as W}from"./LoadingSpinner-DpRhnHc2.js";const X={},Z={viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ee(s,a){return r(),c("svg",Z,a[0]||(a[0]=[i("path",{d:"M15 18.5L9 12.5L15 6.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const te=j(X,[["render",ee]]),ae={},se={viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function le(s,a){return r(),c("svg",se,a[0]||(a[0]=[i("path",{d:"M9 18.5L15 12.5L9 6.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const re=j(ae,[["render",le]]),ne={key:0,class:"flex items-center justify-center sm:justify-end space-x-1 sm:space-x-2"},oe={key:0,class:"px-1.5 py-2 text-slate-500"},ue={key:2,class:"px-1.5 py-2 text-slate-500"},ie={__name:"AppPagination",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0}},emits:["pageChanged"],setup(s,{emit:a}){const d=s,F=a;function n(u){u>=1&&u<=d.totalPages&&u!==d.currentPage&&F("pageChanged",u)}const g=h(function(){return d.currentPage>2}),v=h(function(){return d.currentPage<d.totalPages-1});return(u,o)=>s.totalPages>1?(r(),c("nav",ne,[x(k,{onClick:o[0]||(o[0]=f=>n(s.currentPage-1)),disabled:s.currentPage===1,variant:"outline-blue",size:"sm","custom-class":"w-10 h-10 p-0 flex items-center justify-center sm:w-auto sm:px-4",class:$({"opacity-50 cursor-not-allowed text-slate-600 border-slate-700 hover:bg-transparent":s.currentPage===1})},{default:b(()=>[o[5]||(o[5]=i("span",{class:"hidden sm:inline"},"Назад",-1)),x(te,{class:"h-5 w-5 sm:hidden"})]),_:1,__:[5]},8,["disabled","class"]),x(k,{onClick:o[1]||(o[1]=f=>n(1)),variant:"outline-blue",size:"sm","custom-class":"w-10 h-10 p-0",class:$(s.currentPage===1?"!bg-violet-500 !border-violet-500 !text-white":"text-slate-300 border-slate-700 hover:bg-slate-700/50")},{default:b(()=>o[6]||(o[6]=[w(" 1 ")])),_:1,__:[6]},8,["class"]),g.value?(r(),c("span",oe,"...")):y("",!0),s.currentPage!==1&&s.currentPage!==s.totalPages?(r(),P(k,{key:1,onClick:o[2]||(o[2]=f=>n(s.currentPage)),variant:"outline-blue",size:"sm","custom-class":"w-10 h-10 p-0 !bg-violet-500 !border-violet-500 !text-white"},{default:b(()=>[w(C(s.currentPage),1)]),_:1})):y("",!0),v.value?(r(),c("span",ue,"...")):y("",!0),s.totalPages>1?(r(),P(k,{key:3,onClick:o[3]||(o[3]=f=>n(s.totalPages)),variant:"outline-blue",size:"sm","custom-class":"w-10 h-10 p-0",class:$(s.currentPage===s.totalPages?"!bg-violet-500 !border-violet-500 !text-white":"text-slate-300 border-slate-700 hover:bg-slate-700/50")},{default:b(()=>[w(C(s.totalPages),1)]),_:1},8,["class"])):y("",!0),x(k,{onClick:o[4]||(o[4]=f=>n(s.currentPage+1)),disabled:s.currentPage===s.totalPages,variant:"outline-blue",size:"sm","custom-class":"w-10 h-10 p-0 flex items-center justify-center sm:w-auto sm:px-4",class:$({"opacity-50 cursor-not-allowed text-slate-600 border-slate-700 hover:bg-transparent":s.currentPage===s.totalPages})},{default:b(()=>[o[7]||(o[7]=i("span",{class:"hidden sm:inline"},"Вперед",-1)),x(re,{class:"h-5 w-5 sm:hidden"})]),_:1,__:[7]},8,["disabled","class"])])):y("",!0)}},ce={class:"space-y-8 mt-8"},de={class:"space-y-4 rounded-xl bg-gray-900/50 p-4 shadow-lg sm:p-6"},ge={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ve=["value"],fe=["value"],me=["value"],pe={class:"flex justify-end"},ye={key:1,class:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2 md:gap-x-6 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},xe={__name:"CatalogView",setup(s){const a=G(),d=Y(),F=J(),n=V(d.query.searchQuery||""),g=V(d.query.genre||""),v=V(d.query.year||""),u=V(d.query.sort||"rating.kp|-1"),o=h(()=>a.genres.filter(l=>l.name!=="Для взрослых")),f=h(function(){return a.movies}),I=h(function(){const l=new Date().getFullYear(),t=[];for(let e=l;e>=1950;e--)t.push(e);return t}),_=[{value:"rating.kp|-1",label:"Популярные (сначала)"},{value:"rating.kp|1",label:"Популярные (сначала не)"},{value:"year|-1",label:"Год (сначала новые)"},{value:"year|1",label:"Год (сначала старые)"},{value:"name|1",label:"Название (А-Я)"},{value:"name|-1",label:"Название (Я-А)"}];let z=null;async function m(l=!0){l&&(a.currentPage=1);const t={};n.value&&(t.searchQuery=n.value),g.value&&(t.genre=g.value),v.value&&(t.year=v.value),u.value&&u.value!=="rating.kp|-1"&&(t.sort=u.value),a.currentPage>1&&(t.page=a.currentPage),F.push({query:t});const e={page:a.currentPage,limit:20};n.value&&(e.query=n.value),g.value&&(e["genres.name"]=g.value),v.value&&(e.year=v.value);const T=u.value.split("|");e.sortField=T[0],e.sortType=T[1],await a.loadMovies(e)}function D(){clearTimeout(z),z=setTimeout(function(){m()},500)}function N(l){a.currentPage=l,m(!1),window.scrollTo({top:0,behavior:"smooth"})}function A(){n.value="",g.value="",v.value="",u.value="rating.kp|-1",m()}function E(){A()}function U(){return n.value?"По запросу '"+n.value+"' ничего не найдено.":"Попробуйте изменить критерии фильтрации."}return Q(async function(){a.genres.length===0&&await a.loadGenres();const l=d.query;n.value=l.searchQuery||"",g.value=l.genre||"",v.value=l.year||"",u.value=l.sort||"rating.kp|-1",a.currentPage=parseInt(l.page)||1,m(!1)}),O(function(){return d.query},function(l){n.value=l.searchQuery||"",g.value=l.genre||"",v.value=l.year||"",u.value=l.sort||"rating.kp|-1";const t=parseInt(l.page)||1;a.currentPage!==t&&(a.currentPage=t),m(!1)}),(l,t)=>(r(),c("div",ce,[t[8]||(t[8]=i("h1",{class:"font-poppins text-3xl font-bold text-slate-100 sm:text-4xl md:text-5xl"}," Каталог фильмов ",-1)),i("div",de,[i("div",ge,[x(R,{modelValue:n.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>n.value=e),D],type:"search",placeholder:"Поиск по названию...","has-icon":!0,onEnter:m},null,8,["modelValue"]),S(i("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),onChange:m,class:"w-full rounded-xl border-slate-700 bg-black/20 px-4 py-3 text-slate-300 outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-500"},[t[4]||(t[4]=i("option",{value:""},"Все жанры",-1)),(r(!0),c(q,null,M(o.value,e=>(r(),c("option",{key:e.id,value:e.id},C(e.name),9,ve))),128))],544),[[L,g.value]]),S(i("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),onChange:m,class:"w-full rounded-xl border-slate-700 bg-black/20 px-4 py-3 text-slate-300 outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-500"},[t[5]||(t[5]=i("option",{value:""},"Все года",-1)),(r(!0),c(q,null,M(I.value,e=>(r(),c("option",{key:e,value:e},C(e),9,fe))),128))],544),[[L,v.value]]),S(i("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),onChange:m,class:"w-full rounded-xl border-slate-700 bg-black/20 px-4 py-3 text-slate-300 outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-500"},[(r(),c(q,null,M(_,e=>i("option",{key:e.value,value:e.value},C(e.label),9,me)),64))],544),[[L,u.value]])]),i("div",pe,[x(k,{onClick:A,variant:"outline-blue",size:"sm"},{default:b(()=>t[6]||(t[6]=[w(" Сбросить фильтры ")])),_:1,__:[6]})])]),p(a).isLoading&&f.value.length===0?(r(),P(W,{key:0})):f.value.length>0?(r(),c("div",ye,[(r(!0),c(q,null,M(f.value,e=>(r(),P(K,{key:e.id,movie:e},null,8,["movie"]))),128))])):!p(a).isLoading&&f.value.length===0?(r(),P(B,{key:2,type:"empty",title:"Фильмы не найдены",message:U()},H({_:2},[n.value||g.value||v.value?{name:"actions",fn:b(()=>[x(k,{onClick:E,variant:"primary",size:"md"},{default:b(()=>t[7]||(t[7]=[w(" Сбросить фильтры ")])),_:1,__:[7]})]),key:"0"}:void 0]),1032,["message"])):y("",!0),p(a).hasError?(r(),P(B,{key:3,type:"error",title:"Ошибка загрузки",message:p(a).error},null,8,["message"])):y("",!0),p(a).totalPages>1&&!p(a).isLoading?(r(),P(ie,{key:4,"current-page":p(a).currentPage,"total-pages":p(a).totalPages,onPageChanged:N,class:"mt-8"},null,8,["current-page","total-pages"])):y("",!0)]))}},ke=j(xe,[["__scopeId","data-v-633df643"]]);export{ke as default};
